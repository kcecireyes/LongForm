/*! phew 2013-06-24 */
"use strict";!function(){Function.prototype.setMany=function(){var a=this;return function(){if(0==arguments.length||!arguments[0])return this;if(1==arguments.length)for(var b in arguments[0])var c=a.call(this,b,arguments[0][b]);else c=a.apply(this,arguments);return c}},Function.prototype.mixin=function(a,b){return this[a]=b,this}.setMany(),Function.prototype.implement=function(a,b){return this.prototype[a]=b,this}.setMany(),Function.prototype.extend=function(a){var b=function(){};return b.prototype=a.prototype,this.prototype=new b,this.prototype.constructor=this,this.superClass=a,this},Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Object.mixin({override:function(){for(var a=1;a<arguments.length;++a){var b=arguments[a];for(var c in b)arguments[0][c]=b[c]}return arguments[0]},toValueArray:function(a){if("[object Array]"==Object.prototype.toString.call(a))return a;var b=[];for(var c in a)b.push(a[c]);return b}}),String.implement({breakLine:function(a){a=a||32;for(var b=1,c=this,d=0;b*a<c.length;){var e=b*a+(b-1)+d,f="\n";" "!=c[e]&&" "!=c[e]&&(f="-"+f,++d),c=c.slice(0,e)+f+c.slice(e),++b}return c},trim:function(){return this.replace(/^\s*|\s*$/,"")}}),Array.implement({each:function(a,b){for(var c=0;c<this.length;++c)a.call(b,this[c],c,this);return this},filter:function(a,b){for(var c=[],d=0;d<this.length;++d)a.call(b,this[d],d,this)&&c.push(this[d]);return c},any:function(a,b){for(var c=0;c<this.length;++c)if(a.call(b,this[c],c,this))return!0;return!1},count:function(a,b){for(var c=0,d=0;d<this.length;++d)a.call(b,this[d],d,this)&&++c;return c},min:function(a,b){for(var c=null,d=1<<30,e=0;e<this.length;++e){var f=a.call(b,this[e],e,this);d>f&&(d=f,c=this[e])}return c},flattened:function(){var a=[],b=function(c){c.each(function(c){"[object Array]"==Object.prototype.toString.call(c)?b(c):void 0!==c&&a.push(c)})};return b(this),a},deepcopy:function(){var a=[];return this.each(function(b){"[object Array]"==Object.prototype.toString.call(b)?a.push(b.deepcopy()):a.push(b)}),a}}),["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"].each(function(a){Number.implement(a,function(){return Math[a].call(this,this)})})}(window);var Cache=function(a){var a=a||{};this.hasher=a.hasher||function(a){return a},this.bucket={},this.size=0,this.threshold=a.threshold||1e5}.implement({get:function(a){return a=this.hasher(a),this.bucket[a]},put:function(a,b){a=this.hasher(a),this.bucket[a]=b,++this.size,this.size==this.threshold&&(this.bucket={},this.size=0)},containsKey:function(a){return!!this.get(a)}}),rubbishCache=new Cache,DOM=function(){var a={},b=0;return{uniqueId:function(){return"i"+b++},appendStyle:function(b){if(!a[b]){a[b]=!0;var c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b)),document.getElementsByTagName("head")[0].appendChild(c)}},normalizeDimension:function(a){return a+="",a=a.trim(),"auto"==a||/px$/.test(a)?a:a+"px"}}}(),Candy=function(){return $(function(){DOM.appendStyle(".candy-sel{color: white; text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25); background-color: #006DCC; }.candy-li{position: relative; padding-left: 4px; text-align: left;cursor: default;line-height: 26px;list-style: none;}.candy-wrapper{position: absolute; z-index: 9999; background: white; overflow: hidden; opacity: .0; box-shadow: 0 4px 10px #AAA;}.candy-shot{color: orange;}")}),function(a){this.element=a.element,this.id=a.id||this.element.attr("id")+"_candy",this.candyBox=a.candyBox,this.topOffset=a.topOffset||0,this.widthOffset=a.widthOffset||0,this.wrapperClass=a.wrapperClass||"",this.itemClass=a.itemClass||"",this.shotClass=a.shotClass||"",this.element.parent().append('<div id="'+this.id+'" class="candy-wrapper '+this.wrapperClass+'"></div>'),this.candyPool=$("#"+this.id),this.layout(),this.currentIdx=-1;var b=this;this.element.keyup(function(a){if(b.popout(b.element.val()),38==a.which||40==a.which){switch(a.which){case 40:++b.currentIdx;break;case 38:--b.currentIdx}b.currentIdx=Math.min(b.currentIdx,b.candies.length-1),b.currentIdx=Math.max(b.currentIdx,0),b.refreshSel(),a.stopPropagation()}else if(13==a.which){var c=$("#"+b.id+" > li");b.currentIdx<c.length&&b.currentIdx>-1&&(b.element.val(c[b.currentIdx].innerText),b.hide(),b.currentIdx=-1)}else b.currentIdx=0,b.refreshSel()}),this.element.keydown(function(a){(38==a.which||40==a.which||13==a.which)&&a.preventDefault()}),this.element.focus(function(){b.popout(b.element.val())}),this.element.blur(function(){b.currentIdx=-1,b.hide()})}.implement({layout:function(){var a=this,b=function(){var b=a.element.width()+a.widthOffset,c=a.element.offset(),d=c.left,e=c.top+a.element.height()+a.topOffset;a.candyPool.css({width:b+"px",left:d+"px",top:e+"px"})};window.onresize=b,b()},refreshSel:function(){$("li.candy-sel",this.candyPool).removeClass("candy-sel"),$($("#"+this.id+" > li")[this.currentIdx]).addClass("candy-sel")},popout:function(a){clearTimeout(this.hideTimeout);var b=this.candyBox.getCandies(a);if(0!=b.length){for(var c="",d=0;d<b.length;++d){for(var e=b[d],f=e[1],g=e[0],h=[],i=0;i<f.length;++i)if(0==h.length)h.push([f[i],1]);else{var j=h[h.length-1];j[0]+j[1]==f[i]?++j[1]:h.push([f[i],1])}if(0==h.length)var k=g;else{k="";for(var l=0,i=0;i<h.length;++i){var m=h[i],n=m[0],o=m[1];k+=g.substr(l,n-l)+'<span class="candy-shot '+this.shotClass+'">'+g.substr(n,o)+"</span>",l=n+o}k+=g.substr(l)}c+='<li class="candy-li '+this.itemClass+'">'+k+"</li>"}this.candies=b,this.candyPool.html(c),this.candyPool.css({border:"1px solid #ccc",opacity:1});var p=this;this.dropdown=$("#"+this.id+" > li"),this.dropdown.hover(function(a){for(var b=a.srcElement,c=b.parentNode.children,d=0;d<c.length;++d)if(c[d]==b){p.currentIdx=d,p.refreshSel();break}}),this.dropdown.click(function(){p.currentIdx=-1;var a=this,b=a.innerText;p.element.val(b),p.hide()})}},hide:function(){this.candyPool.css({opacity:0}),this.hideTimeout=setTimeout(function(){this.candyPool.html(""),this.candyPool.css({border:""})}.bind(this),300)}})}(),DefaultDataProvider=function(a){this.data=a.data}.implement({provide:function(){return this.data}}),DynamicDataProvider=function(){}.implement({provide:function(a){for(var b=[],c=0;10>c;++c){for(var d=a,e=0;e<Math.min(c,5);++e)d+=c;b.push(d)}return b}}),LevensteinCandyBox=function(){var a=function(a,b){function c(d,e){if(-1==d)return[-1==e?0:e+1,[]];if(-1==e)return[-1==d?0:d+1,[]];if(f[[d,e]])return f[[d,e]];var g=[];g[0]=c(d-1,e-1).deepcopy(),a[d]!=b[e]?g[0][0]+=1:g[0][1].push(e),g[1]=c(d-1,e).deepcopy(),g[2]=c(d,e-1).deepcopy(),g[1][0]+=1,g[2][0]+=1;for(var h=g.min(function(a){return a[0]}),i=[h[0],[]],j=0;j<h[1].length;++j)i[1].push(h[1][j]);return f[[d,e]]=i,h}var d=[a,b];if(window.rubbishCache){var e=window.rubbishCache.get(d);if(e)return e}var f={};return e=c(a.length-1,b.length-1)};return function(a){this.dataProvider=a.dataProvider||new DefaultDataProvider}.implement({getCandies:function(b){var c=this.dataProvider.provide(b),d=[];c.each(function(c){var e=a(b.toLowerCase(),c.toLowerCase());d.push([e[0],c,e[1]])}),d.sort(function(a,b){for(var c=a[2],d=b[2],e=a[0],f=b[0],g=1,h=0;h<c.length;++h)e-=g,h>0&&c[h]==c[h-1]+1?++g:g=1;g=1;for(var h=0;h<d.length;++h)f-=g,h>0&&d[h]==d[h-1]+1?++g:g=1;return e-f});var e=[];return d.each(function(a){e.push([a[1],a[2]])}),e}})}(),Box=function(a){this.type=a.type||"div",this.attributes=a.attributes||{},this.parent=a.parent||null,this.children=[]}.implement({render:function(){var a="<"+this.type;for(var b in this.attributes)this.attributes[b]&&""!=this.attributes[b]&&(a+=" "+b+'="'+this.attributes[b]+'" ');return a+=">",this.children.each(function(b){a+=b.render()}),a+="</"+this.type+">"},appendChild:function(a){a.parent=this,this.children.push(a)}}),Container=function(a){this.id=a.id||DOM.uniqueId(),this.width=a.width||"auto",this.height=a.height||247,this.width=DOM.normalizeDimension(this.width),this.height=DOM.normalizeDimension(this.height),this["class"]=a["class"],this.ratio=a.ratio||60,this.innerClass=a.innerClass||null,this.innerId=a.innerId||DOM.uniqueId(),this.indicatorId=DOM.uniqueId(),this.thumbId=DOM.uniqueId(),this.container=new Box({attributes:{id:this.id,style:"position: relative;width:"+this.width+";"+"height: "+this.height+";"+"overflow: hidden;","class":this["class"]}}),this.inner=new Box({attributes:{id:this.innerId,style:"position: absolute;height: 100%;width: 200%;transition: all .3s ease-out; -webkit-transition: all .3s ease-out;-moz-transition: all .3s ease-out;-o-transition: all .3s ease-out;","class":this.innerClass}}),this.indicator=new Box({attributes:{id:this.indicatorId,style:"position: absolute;height: 7px;width: 100%;bottom: 0;left: 0;border-top: 1px solid whitesmoke;border-bottom: 1px solid whitesmoke;background: white;opacity: .8;"}}),this.thumb=new Box({attributes:{id:this.thumbId,style:"position: absolute;height: 7px;bottom: 0;left: 0;background: black;opacity: .7;transition: all .3s ease-out;-webkit-transition: all .3s ease-out;-moz-transition: all .3s ease-out;-o-transition: all .3s ease-out;"}}),this.container.appendChild(this.inner),this.container.appendChild(this.indicator),this.container.appendChild(this.thumb),this.curScroll=0}.implement({attach:function(a){function b(a,b){d._showIndicator(),b=b||1;var c=$("#"+d.id),e=$("#"+d.innerId,c);d.curScroll+=d.ratio*Math.abs(a)/a*b;var h=c.width(),i=e.width();h>=i&&(f.css({display:"none"}),g.css({display:"none"}));var j=h/i*h;f.width(j);var k=h-i;d.curScroll=Math.max(k,d.curScroll),d.curScroll=Math.min(0,d.curScroll),e.css({left:d.curScroll+"px"});var l=d.curScroll/i*h;return f.css({left:-l+"px"}),d.curScroll==k||0==d.curScroll?!1:!0}var c=this.container.render();$("#"+a).append($(c));var d=this,e=$("#"+this.id),f=$("#"+this.thumbId),g=$("#"+this.indicatorId);return e.on("DOMMouseScroll mousewheel",function(a){var c=d._extractDelta(a);b(c)&&(a.stopPropagation(),a.preventDefault())}),$(window).on("keydown",function(a){switch(a=a||window.event,console.log(a.which),a.which){case 37:case 38:b(1,5);break;case 39:case 40:b(-1,5)}36<a.which&&a.which<41&&(a.stopPropagation(),a.preventDefault())}),setTimeout(function(){b(1,0)},400),this},_hideIndicator:function(){var a=$("#"+this.thumbId),b=$("#"+this.indicatorId);a.css({opacity:"0"}),b.css({opacity:"0"})},_showIndicator:function(){clearTimeout(this._hideIndicatorHandle);var a=$("#"+this.thumbId),b=$("#"+this.indicatorId);a.css({opacity:".7"}),b.css({opacity:".7"}),this._hideIndicatorHandle=setTimeout(this._hideIndicator.bind(this),1e3)},_extractDelta:function(a){return a.wheelDelta?a.wheelDelta:a.detail?-40*a.detail:a.originalEvent&&a.originalEvent.wheelDelta?a.originalEvent.wheelDelta:-40*a.originalEvent.detail},horizontify:function(a){function b(){var a=0;d.contents.each(function(b){a+=d._elementWidth(b)}),a+=100,c.css({width:a+"px"})}var c=$("#"+this.innerId);this.contents=[];var d=this,c=$("#"+d.innerId,$("#"+d.id)),e=parseInt(c.css("padding-top")),f=parseInt(c.css("padding-bottom")),g=c.height()-f-e;a.each(function(a,b){var e=$(b.outerHTML);e.on("DOMMouseScroll mousewheel",function(a){var b=d._extractDelta(a);if(this.scrollHeight!=this.offsetHeight){if(0==this.scrollTop&&b>0)return;if(this.scrollTop+this.offsetHeight==this.scrollHeight&&0>b)return;(this.scrollTop+this.offsetHeight<this.scrollHeight||b>0)&&a.stopPropagation()}}),e.css({"max-height":g+"px",position:"relative","float":"left"}),d.contents.push(e),c.append(e),b.parentNode.removeChild(b)}),b(),setTimeout(function(){b()},1e3)},_elementWidth:function(a){var b=$(a),c=parseInt(b.css("margin-left")),d=parseInt(b.css("margin-right")),e=parseInt(b.css("border-left-width")),f=parseInt(b.css("border-right-width"));return $(a).width()+c+d+e+f}});